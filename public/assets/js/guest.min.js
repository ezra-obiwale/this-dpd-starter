var app=new ThisApp({crud:{status:{successValue:200}}}),_=function(e){return app._(e)},_c=function(e){return e?app.container.find(e):app.container},store=function(e,a){return void 0===a?localStorage.getItem(e):null===a?localStorage.removeItem(e):localStorage.setItem(e,a)},$container=$("body");app.debug(!0).setDefaultLayout("main").onError(function(e){var a=app._("#error").html(e).removeClass("hidden");setTimeout(function(){a.addClass("hidden")},4e3)}).secureAPI(function(e,a){var s=app.store("ssn").find(1);s&&s.k&&(e["X-API-TOKEN"]=s.k)}).setBaseURL("http://localhost:2403/").before("form.send",function(){_(this).find('[type="submit"]').addClass("hidden").siblings().removeClass("hidden"),_(this).closest(".modal-body").siblings(".modal-footer").addClass("hidden")}).before("page.load",function(){if(!app.loadedPartial){if(app.params.rpswd)delete app.params.rpswd,app.params.token&&($(_c("#reset-password-2.modal").get(0)).modal("show").find('[name="token"]').val(app.params.token),delete app.params.token);else if(void 0!==app.params.ev){var e="Email verified successfully",a="alert-success";0==app.params.ev?(e="Email verification failed.",a="alert-danger"):1==app.params.ev&&(e="Email already verified.",a="alert-info"),$(_c("#login-email-password.modal").get(0)).modal("show").find(".modal-footer").removeClass("hidden").children().addClass(a).html(e),delete app.params.ev}var s=app.store("ssn").find(1),t=function(){store("exited")&&($(_c("#login.modal").get(0)).modal("show").find(".modal-footer").removeClass("hidden").children().addClass("alert-info").html("Session expired"),store("exited",null)),_c("li.btn.auth").removeClass("hidden"),_c("li.btn.account").addClass("hidden"),app.store("ssn").drop()},o=function(e,a){var s=e.e-Date.now()-60*a*1e3,i=function(){app.request({type:"post",url:"user/renew-token",data:{id:e.i}}).then(function(s){200===s.status?(e={e:s.data.expires,i:e.i,k:s.data.apiKey,v:s.data.verified},app.store("ssn").save(e,1,!0),o(e,a)):t()}).catch(t)};return s>0?setTimeout(i,s):void i()};s&&s.e>Date.now()?app.request("user/me").then(function(e){200===e.status?(_c("li.btn.auth").addClass("hidden"),_c("li.btn.account").removeClass("hidden").find("a").attr("href",e.data.path),o(s,10)):t()}).catch(t):t(),$container=$(_c().get(0)),$container.tooltip({selector:'[data-toggle="tooltip"]',container:"body"})}}).when("page.loaded","page",function(){$('[data-toggle="tooltip"]').tooltip()}).on("click",".input-group-addon",function(){var e=_(this).siblings();"password"===e.attr("type")?(e.attr("type","text"),_(this).html("hide")):(e.attr("type","password"),_(this).html("show"))}).on("form.submission.success form.submission.error form.submission.failed","form",function(e){var a=e.detail.responseData,s=_(this).closest(".modal"),t=s.find(".modal-footer").children(),o=_(this).find('img[alt="loading"]').addClass("hidden").siblings().removeClass("hidden");if(200!==a.status){var i=a.message;a.errors&&(i="<ul>",app.__.forEach(a.errors,function(e,a){i+="<li><strong>"+e+"</strong> "+a+"</li>"}),i+="</ul>"),t.removeClass("alert-success alert-info").addClass("alert-danger").html(i||"No internet connection")}else{var i="Sign up successful. Please check your email for confirmation.";switch(s.attr("id")){case"login-email-password":var r="."+a.data.path;return app.params.r&&(r+=decodeURIComponent(app.params.r)),app.store("ssn").save({k:a.data.apiKey,i:a.data.uid,v:a.data.verified,e:a.data.expires},1),app.store("ssn").save({id:a.data.uid},"u"),location.href=r,void o.addClass("hidden").siblings().removeClass("hidden");case"reset-password":i="Password reset email sent.";break;case"reset-password-2":i="Password reset successfully.";break;case"resend-verification-email":i="Verification email resent."}$(s.get(0)).modal("hide"),s=_c("#login-email-password.modal"),t=s.find(".modal-footer").children(),t.removeClass("alert-danger alert-info").addClass("alert-success").html(i),this.reset(),$(s.get(0)).modal("show")}t.parent().removeClass("hidden")}).start("home",!0),$(".modal").on("hide.bs.modal",function(){$(this).find(".modal-footer").addClass("hidden")});